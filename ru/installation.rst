Установка
############

CakePHP довольно прост и легок в установке. Минимальные требования - веб-сервер и копия CakePHP, это все что Вам нужно! Этот раздел сосредоточен на установке CakePHP на Apache (поскольку он прост в установке и настройке), но CakePHP может также работать и с другими веб-серверами, как Nginx, LightHTTP или Microsoft IIS.

Требования к устаноке
=====================

- HTTP сервер. Например: Apache. Предпочтительно с mod\_rewrite, но необязательно.
- PHP 5.6.0 или выше (включая PHP 7.1).
- Расширение mbstring для PHP 
- Расширение intl для PHP 

.. note::

    В XAMPP и WAMP, расширение mbstring работает по умолчанию.

    В XAMPP, расширение intl установлено, но не включено, чтобы включить intl Вам необходимо раскомментировать
    ``extension=php_intl.dll`` в файле **php.ini** и перезапустить сервер, используя
    XAMPP панель.

    В WAMP, расширение intl установлено, но не включено.
    Чтобы включить intl Вам необходимо перейти в директорию в которой расположен php
    **C:\\wamp\\bin\\php\\php{version}**, скопируйте все файлы, которые выглядят как
    **icu*.dll** и вставьте а директорию apache\bin
    **C:\\wamp\\bin\\apache\\apache{version}\\bin**. После этого перезапустите сервер.

Поскольку ядро базы данных не требуется, мы предполагаем что большинсво приложений будут использовать одно ядро. CakePHP поддерживает различные движки базы данных:

-  MySQL (5.1.10 или выше)
-  PostgreSQL
-  Microsoft SQL Server (2008 или выше)
-  SQLite 3

.. note::

    Все встроенные драйвера баз данных требуют PDO. Вы должны убедиться, что у Вас установлены корректные расширения PDO.

Установка CakePHP
=================

Прежде чем вы начнете установку убедитесь что у Вас установлена необходимая
минимальная версия PHP (5.6.0):

.. code-block:: bash

    php -v

У Вас, по крайней мере, должен быть установлен PHP 5.6.0 (CLI) или выше.
Ваш веб-сервер так же должен иметь версию PHP 5.6.0 или выше, и 
версия интерфейса командной строки PHP (CLI) 5.6.0 или выше.

Установка Composer
-------------------

CakePHP использует мендежер зависимостей PHP `Composer <http://getcomposer.org>`_,
как официально поддерживаемый метод установки.

- Установка Composer на Linux и macOS

  #. Запустите скрипт установки, как описано в
     `официальной документации Composer <https://getcomposer.org/download/>`_
     и следуйте инструкциям по установке, чтобы установить Composer.
  #. Выполните следующую команду, чтобы переместить composer.phar в директорию
     по адресу::

         mv composer.phar /usr/local/bin/composer

- Установка Composer на Windows

  Для  установки Composer на Windows, вы можете скачать установщик Composer для
  Windows `здесь <https://github.com/composer/windows-setup/releases/>`__.  Более
  подробные инструкции по установке Composer на Windows можно найти в README
  `здесь <https://github.com/composer/windows-setup>`__.

Создание проекта CakePHP
------------------------

Теперь, когда вы скачали и установили Composer, предположим вы хотите создать
новое приложение CakePHP в папке my_app_name. Для этого просто выполните
следующую команду composer:

.. code-block:: bash

    php composer.phar create-project --prefer-dist cakephp/app my_app_name

Или если Composer установлен глобально:

.. code-block:: bash

    composer self-update && composer create-project --prefer-dist cakephp/app my_app_name
    
Как только Composer закончит скачивание каркаса приложения и библиотеки ядра
CakePHP, у вас должно появиться полностью работоспособное приложение CakePHP.
Убедитесь в том, чтобы в папке вашего приложения всегда были файлы
composer.json и composer.lock.

Вы можете перейти по тому пути, куда установлено ваше приложение CakePHP и
вы увидите стандартную домашнюю страницу. Чтобы изменить ее содержимое, вы
можете отредактировать файл **src/Template/Pages/home.ctp**.

Несмотря на то, что composer является рекомендуемым методом установки,
имеются также готовые сборки доступные для скачивания на
`Github <https://github.com/cakephp/cakephp/tags>`__. Эти сборки содержат
каркас приложения со всеми установленными пакетами. Также они содержат
файл ``composer.phar``, таким образом вы получаете все необходимое для
дальнейшей работы.

Обновление CakePHP до актуальной версии
---------------------------------------

По умолчанию в файле **composer.json** вашего приложения присутствуют
следующие настройки::

    "require": {
        "cakephp/cakephp": "3.4.*"
    }
    
Каждый раз при запуске команды ``php composer.phar update`` вы будете получать
патчи для данной минорной версии. Вы все же можете изменить это значение на
``~3.4`` для получения последней стабильной версии ветки ``3.x``.

Если вы хотите получать позднейшие изменения в CakePHP, еще не вошедшие в релиз,
установите значение версии **dev-master** в файле **composer.json**::

    "require": {
        "cakephp/cakephp": "dev-master"
    }

Учтите, что устанавливать данное значение не рекомендуется, так как это может
нарушить работоспособность вашего приложения при установке следующей релизной
версии. В дополнение к этому composer не кеширует промежуточные ветки
разработки, и это может привести к замедлению последующих обновлений через
composer.

Установка с помощью Oven
------------------------

Еще один быстрый способ установки CakePHP это
`Oven <https://github.com/CakeDC/oven>`_. Это простой PHP-скрипт, который
определяет, что требуется скачать, уcтанавливает каркас приложения CakePHP
и выполняет все необходимые предварительные настройки.

После завершения установки вы также получите работоспособное приложение
CakePHP.

.. note::

    ВАЖНО: Этот скрипт не предназначен для внедрения, его целью является лишь
    помощь тем разработчикам, которые прежде не сталкивались с установкой CakePHP
    и которым нужно быстро получить готовое окружение за считанные секунды.
    Для продакшена необходимо учитывать также некоторые другие факторы, такие как
    права доступа для файлов, конфигугация виртуального хоста и др.
    
Права доступа
=============

CakePHP использует папку **tmp** для ряда различных операций. Описания
модели, кешированные виды, сессионные данные - это лишь некоторые примеры.
Папка **logs** используется для записи лог-файлов стандартным движком
``FileLog``.

Поэтому убедитесь, что в вашем приложении CakePHP для папок **logs**, **tmp**
и всех их подпапок установлены разрешения для записи данных пользователями.
Composer при установке автоматически устанавливает правана запись для папки
**tmp** и ее подпапок для большего удобства, но вы всегда можете
перенастроить эти параметры в случае необходимости.

Проблема в том, что папки **logs** и **tmp**, а также их подпапки должны быть
доступны для записи как со стороны веб-сервера, так для пользователей
командной строки. В системе UNIX, если учетная запись пользователя веб-сервера
не совпадает с учетной записью пользователя командной строки, вы можете
выполнить следующие команды из папки вашего приложения всего лишь один раз,
чтобы быть уверенным в том, что разрешения будут настроены корректно:

.. code-block:: bash

    HTTPDUSER=`ps aux | grep -E '[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx' | grep -v root | head -1 | cut -d\  -f1`
    setfacl -R -m u:${HTTPDUSER}:rwx tmp
    setfacl -R -d -m u:${HTTPDUSER}:rwx tmp
    setfacl -R -m u:${HTTPDUSER}:rwx logs
    setfacl -R -d -m u:${HTTPDUSER}:rwx logs
    
Чтобы воспользоваться инструментами консоли CakePHP, вы должны убедиться, что
файл ``bin/cake`` работоспособен. На \*nix или macOS вы можете выполнить
команду:

.. code-block:: bash

    chmod +x bin/cake

В Windows, файл **.bat** должен быть сразу готов к работе. Если вы используете
Vagrant, либо какую-то еще оболочку виртуальной среды, то любые общие папки
должны обладать разрешениями на исполнение (Пожалуйста обратитесь к документации
вашей виртуальной среды для решения этой задачи).

Если же по какой-либо причине вы не можете изменить разрешения для файла 
``bin/cake``, можете  запустить консоль CakePHP командой:

.. code-block:: bash

    php bin/cake.php
    
Встроенный веб-сервер PHP
=========================

Встроенный веб-сервер PHP - это самый быстрый способ настройки  CakePHP. В
данном примере мы будем использовать консоль CakePHP для запуска встроенного
веб-сервера PHP, который сделает ваше приложение доступным по адресу следующего
вида - **http://host:port**. Из папки приложения выполните:

.. code-block:: bash

    bin/cake server

Без передачи дополнительных параметров эта команда сделает ваше приложение
доступным по адресу **http://localhost:8765/**.

Если у вас имеется что-нибудь конфликтующее с именем **localhost** или портом
8765, вы можете указать в консоли CakePHP запустить веб-сервер на определенном
хосте и/или номере порта используя следующие параметры:

.. code-block:: bash

    bin/cake server -H 192.168.13.37 -p 5673

Это сделает ваше приложение досупным по адресу **http://192.168.13.37:5673/**.

Вот и все - ваше приложение работает, и нет необходимости в настройке
веб-сервера.

.. warning::

    Встроенный веб-сервер *никогда* не следует использовать в продакшене.
    Он предназначается только для тестирования приложения в процессе разработки.
    
Если вы предпочтете использовать полноценный веб-сервер, у вас должна быть
возможность переместить вашу установку CakePHP (включая скрытые файлы) в
корневую папку вашего веб-сервера. В таком случае вы должны иметь возможность
направить ваш браузер в ту папку, в которую вы поместили файлы, и вы увидите
ваше приложение в действии.

Полноценная установка
=====================

Полноценная установка - это более гибкий способ настройки CakePHP. Его 
использование позволяет всему домену действовать как единому приложению
CakePHP. Данный пример поможет вам установить CakePHP в вашей файловой системе,
и сделать его доступным по адресу http://www.example.com. Учтите, что вам
могут понадобиться права для изменения ``DocumentRoot`` на веб-серверах
Apache.



.. _url-rewriting:

Переопределение URL
===================

.. _GitHub: http://github.com/cakephp/cakephp
.. _Composer: http://getcomposer.org

.. meta::
    :title lang=ru: Установка
    :keywords lang=ru: apache mod rewrite,microsoft sql server,tar bz2,папка tmp,database storage,archive copy,tar gz,source application,current releases,web servers,microsoft iis,copyright notices,database engine,bug fixes,lighthttpd,repository,enhancements,source code,cakephp,incorporate
